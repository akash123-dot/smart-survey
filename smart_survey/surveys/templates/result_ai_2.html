{% extends 'base.html' %}

{% block content %}
    {% if not data %}
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Generate Question</button>
        </form>
    {% endif %}

    <a href="{% url 'AI-survey' survey_id=survey_id %}"> Ask AI Again </a>
    <hr>





    <!-- ✅ AI Generated Data -->
    {% if data %}
        <!-- ✅ Save All Questions -->
        <form method="post" action="{% url 'SaveAllAiQuestions' survey_id %}">
            {% csrf_token %}
            <textarea name="data" hidden>{{ json_data|safe }}</textarea>
            <button type="submit">Save All Questions & Back to manual question</button>
        </form>
        <hr>

        {% for item in data %}
            <form method="post" action="{% url 'save-question' survey_id %}">
                {% csrf_token %}

                <div style="margin-bottom: 20px; border: 1px solid #ddd; padding: 12px; border-radius: 6px;">
                    
                    <!-- ✅ Question Text -->
                    <p><strong>{{ item.text }}</strong></p>
                    <input type="hidden" name="text" value="{{ item.text }}">
                    <input type="hidden" name="question_type" value="{{ item.question_type }}">

                    <!-- ✅ Options handling -->
                    {% if item.options %}
                        <ul style="list-style: none; padding-left: 0;">
                        {% if item.question_type == 'single_choice' %}
                            {% for option in item.options %}
                                <li>
                                    <label>
                                        <input type="radio" disabled>
                                        {{ option }}
                                    </label>
                                </li>
                            {% endfor %}
                            <input type="hidden" name="options" value="{{ item.options|join:',' }}">
                        
                        {% elif item.question_type == 'multiple_choice' %}
                            {% for option in item.options %}
                                <li>
                                    <label>
                                        <input type="checkbox" disabled>
                                        {{ option }}
                                    </label>
                                </li>
                            {% endfor %}
                            <input type="hidden" name="options" value="{{ item.options|join:',' }}">
                        {% endif %}
                        </ul>

                    {% else %}
                        <!-- ✅ Text input type -->
                        <input type="text" disabled placeholder="User answer here">
                    {% endif %}

                    <button type="submit" name="save_single">Save Question</button>

                </div>
            </form>
        {% endfor %}
    {% endif %}

    <a href="{% url 'question' survey_id=survey_id %}"> Back to manual question </a>

{% endblock %}




